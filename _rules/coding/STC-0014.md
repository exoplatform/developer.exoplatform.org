---
title: STC-0014
tagline: Never use == to compare Objects
permalink: /rules/STC-0014/
author: fbassy
tags: [bug]
controlsSeverity: [blocker]
status: validated
validationDate: 2011-11-30
sinceLevel: exo-1_1
---

<a name="what"></a>
## What?

### <i class="fa fa-info-circle"></i> The rule

Use `equals()` to compare object references, avoid comparing them with `==` or `!=`.

Using `==` or `!=` to compare object only works if an object1 is a reference to the same object. This will be false if the
Object has been post-compute.

### <i class="fa fa-lightbulb-o"></i> The solution

You have to use the [`.equals()`](http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html#equals(java.lang.Object|))
function.

The best way to test equality between Object is to Override your `equals()` method and `hashCode()` method.

<a name="why"></a>
## Why?

The use of `==` with object is generally limited to the following:

  * Comparing to see if a reference is null.
  * Comparing two enum values. This works because there is only one object for each enum constant.
  * You want to know if two references are to the same object

`equals()` method resolved an equality by using hashCode() function. This returns a small number based on the object's internal
 datastructure. If two objects have different hash codes, then they cannot be equal to each other.

The method  `equals()` is defined in the Object class, from which all other classes are derived, it's automatically defined for
every class. However, it doesn't perform an intelligent comparison for most classes unless the class overrides it. It has been
defined in a meaningful way for most Java core classes (such as String, Integer,...) If it's not defined for a class
that you created, it behaves the same as `==`.

<a name="examples"></a>
## Examples

<div class="panel panel-danger">
  <div class="panel-heading">
    <h3 class="panel-title"><i class="fa fa-thumbs-down pull-right"></i> Wrong Java example</h3>
  </div>
  <div class="panel-body">

{% highlight java %}
public class EqualsExample {

  public static void main(String args[] ) {

    Foo exoObject = new Foo();
    exoObject.setId("test");
    exoObject.setSmallInt(1);
    Foo exoObject2 = new Foo();
    exoObject2.setId("test");
    exoObject2.setSmallInt(1);
    System.out.println(exoObject2.hashCode());
    System.out.println(exoObject.hashCode());

    System.out.println("exoObject.equals: " + exoObject.equals(exoObject2));	// FALSE
    System.out.println("exoObject ==    : " + (exoObject == exoObject2));	  // FALSE

  }
}

class Foo {

  public Foo() {
  }

  private String id;
  private Integer smallInt;

  public String getId() {
    return id;
  }

  public void setId(String id) {
    this.id = id;
  }

  public Integer getSmallInt() {
    return smallInt;
  }

  public void setSmallInt(Integer smallInt) {
    this.smallInt = smallInt;
  }

}
{% endhighlight %}

  </div>
</div>


<div class="panel panel-success">
  <div class="panel-heading">
    <h3 class="panel-title"><i class="fa fa-thumbs-up pull-right"></i> Good Java example</h3>
  </div>
  <div class="panel-body">

{% highlight java %}
public class EqualsExample {

  public static void main(String args[] ) {

    Foo exoObject = new Foo();
    exoObject.setId("test");
    exoObject.setSmallInt(1);
    Foo exoObject2 = new Foo();
    exoObject2.setId("test");
    exoObject2.setSmallInt(1);
    System.out.println(exoObject2.hashCode());
    System.out.println(exoObject.hashCode());

    System.out.println("exoObject.equals: " + exoObject.equals(exoObject2));	// TRUE
    System.out.println("exoObject ==    : " + (exoObject == exoObject2));	  // FALSE

  }
}

class Foo {

  public Foo() {
  }

  private String id;
  private Integer smallInt;

  // Getters, Setters, Equals and Hashcode has been generated by Eclipse.

  public String getId() {
    return id;
  }

  public void setId(String id) {
    this.id = id;
  }

  public Integer getSmallInt() {
    return smallInt;
  }

  public void setSmallInt(Integer smallInt) {
    this.smallInt = smallInt;
  }

  @Override
  public int hashCode() {
    final int prime = 31;
    int result = 1;
    result = prime * result + ((id == null) ? 0 : id.hashCode());
    result = prime * result + ((smallInt == null) ? 0 : smallInt.hashCode());
    return result;
  }

  @Override
  public boolean equals(Object obj) {
    if (this == obj)
      return true;
    if (obj == null)
      return false;
    if (getClass() != obj.getClass())
      return false;
    Foo other = (Foo) obj;
    if (id == null) {
      if (other.id != null)
        return false;
    } else if (!id.equals(other.id))
      return false;
    if (smallInt == null) {
      if (other.smallInt != null)
        return false;
    } else if (!smallInt.equals(other.smallInt))
      return false;
    return true;
  }

}
{% endhighlight %}

  </div>
</div>


<a name="controls"></a>
## <i class="fa fa-shield"></i> Controls

### for Java

<div class="table-responsive">
  <table class="table">
    <thead>
      <tr>
        <th>Rule Type</th>
        <th>Rule</th>
        <th>Rule Settings</th>
        <th>Severity</th>
      </tr>
    </thead>
    <tbody>
    <tr>
      <td>PMD</td>
      <td><a href="http://pmd.sourceforge.net/rules/design.html#CompareObjectsWithEquals">CompareObjectsWithEquals</a></td>
       <td>
       </td>
       <td>BLOCKER</td>
     </tr>
   </tbody>
  </table>
</div>
