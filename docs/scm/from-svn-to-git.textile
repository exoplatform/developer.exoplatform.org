---
layout: page
title: "From SVN to Git"
tags: [git,svn]
group: scm
---
{% include JB/setup %}

<div class="row">
  <div class="span12">

h2. Post migration cleanup by projects teams

Technical conversion of eXo projects stored in Subversion into Git repositories will be processed by the Software Factory Team.
Once the migration done each team will have to process some tasks to finalize the project migration.

h3. Clean-up project branches

Due to the migration process you may find in the new Git repository various branches you didn't have in your SVN project.

These branches may have various origins :

## It was a development branch removed in SVN. The migration process restore all branches found in SVN history but never deletes them. You can remove them with @git push :<BRANCH>@
## It is a real stable branch. Following our "workflow":./git-workflow.html it has be renamed @stable/A.B.x@.
## It is a real development branch with some work in progress and is not yet merged. Following our "workflow":./git-workflow.html it has be renamed @feature/my-super-cool-feature@ where @my-super-cool-feature@ describes this feature.

h3. Clean-up tags

Due to the migration process you may find in the new Git repository various tags you didn't have in your SVN project.
Like branches this is because the migration process never delete what it found in SVN history.
The tag existed and was renamed or deleted.
It can be safely deleted with :

{% highlight sh %}
# remove it locally
$ git tag -d 12345
# remove it on remote
$ git push origin :refs/tags/12345
{% endhighlight %}

h3. Rename a branch

For almost all branche have to be renamed (feature and stable branch).
To do it, follow these steps :

{% highlight sh %}
# Move to branch
git checkout branch-name
# Rename the branch
git branch -m branch-name feature/branch-name
# Push new branch
git push origin feature/branch-name
# remove old branch
git push origin :branch-name
{% endhighlight %}

If the branch is a stable branch, use @stable/@ instead of @feature/@

h3. Split development and blessed repositories

Following our workflow all projects involved in products development have two repositories, one dedicated for development stuffs and one blessed repository to centralize stable stuffs.

By default in the migration process, both repositories will be synchronized before the opening of push rights on @blessed@ repositories.
@Projects keepers@ will have to remove useless branches in both repositories :

* No @stable@ branch in @development@ repositories
* No @fix@ branch in @blessed@ repositories
* No @feature@ branch in @blessed@ repositories

h4. How to cleanup branches

We suppose you are working in the project hosted in the git repository @xxx@.
The first time you need create a local clone of the development repository of @xxx@.

{% highlight sh %}
git clone git@github.com:exodev/xxx.git
cd xxx
{% endhighlight %}

And you add a remote repository to access to the @blessed@ repository

{% highlight sh %}
git remote add blessed git@github.com:exoplatform/xxx.git
git fetch blessed
{% endhighlight %}

You can list all branches with

{% highlight sh %}
git branch -a
{% endhighlight %}

You have to remove each fix branch from the @blessed@ repository with

{% highlight sh %}
git push blessed :fix/A.B.x/ISSUE-123
{% endhighlight %}

You have to remove each feature branch from the blessed repository with

{% highlight sh %}
git push blessed :feature/branch-name
{% endhighlight %}

After having synchronized a last time changes from development repository to blessed repository you have to remove each stable branch from development repository

{% highlight sh %}
# Checkout the current stable branch from blessed repo
git checkout -b stable/A.B.x blessed/stable/A.B.x
# Merge changes from developement repo
git merge origin/stable/A.B.x
# You shouldn't have any conflict
# Push changes in blessed repo
git push blessed
# Delete stable branch in development repo
git push origin :stable/A.B.x
{% endhighlight %}

h3. Update your maven build

h4. Update SCM infos

Has you changed where sources are stored you have to reflect it in your "project POM":http://maven.apache.org/scm/git.html.
These changes have to be done in *ALL* active branches of the project.

The SCM connection URL must allow pull access. It has to follow this pattern (XXX being your repository name in github) 

{% highlight xml %}
 <connection>scm:git:git://github.com/exoplatform/XXX.git</connection>
{% endhighlight %}

The SCM developer connection URL must allow pull and push access. It has to follow this pattern (XXX being your repository name in github) 

{% highlight xml %}
 <developerConnection>scm:git:git@github.com:exoplatform/XXX.git</developerConnection>
{% endhighlight %}

Here is a sample of an entry used with Subversion :

{% highlight xml %}
<scm>
 <connection>scm:svn:http://svn.exoplatform.org/projects/ks/trunk</connection>
 <developerConnection>scm:svn:http://svn.exoplatform.org/projects/ks/trunk</developerConnection>
 <url>http://fisheye.exoplatform.org/browse/ks</url>
</scm>
{% endhighlight %}

You have to replace it by this entry for Git(hub) :

{% highlight xml %}
<scm>
 <connection>scm:git:git://github.com/exoplatform/ks.git</connection>
 <developerConnection>scm:git:git@github.com:exoplatform/ks.git</developerConnection>
 <url>http://fisheye.exoplatform.org/browse/ks</url>
</scm>
{% endhighlight %}

h4. Upgrade plugins versions

Few maven plugins weren't compatible with Git (or had issues).
* maven-release-plugin : Version 2.2.1 is recommanded
* buildnumber-maven-plugin : Version 1.0 min is required

For projects inheriting from eXo parent POM version >= 2 you just have to had/update these properties in your project parent POM :

{% highlight xml %}
<version.release.plugin>2.2.1</version.release.plugin>
<version.buildnumber.plugin>1.0</version.buildnumber.plugin>
{% endhighlight %}

For projects inheriting from eXo parent POM version 1.x you have to had the following entry in your project parent POM :

{% highlight xml %}
<pluginManagement>
  <!-- All plugins ordered by shortname (antrun, assembly ...) -->
  <plugins>
    <plugin>
      <groupId>org.codehaus.mojo</groupId>
      <artifactId>buildnumber-maven-plugin</artifactId>
      <version>1.0</version>
    </plugin>
    <plugin>
      <groupId>org.apache.maven.plugins</groupId>
      <artifactId>maven-release-plugin</artifactId>
      <version>2.2.1</version>
    </plugin>
  </plugins>
</pluginManagement>
{% endhighlight %}

It is recommended to plan to upgrade your eXo Parent POM version if you have to maintain this branch

h4. Build tags

You may have a build issue if the @buildnumber-maven-plugin@ is too old while trying to build an old tagged release.
If the tagged project inherit from an eXo parent POM >= version 2 thus add this option in the comand line : @-Dversion.buildnumber.plugin=1.0@
For 1.x eXo parent POM add @-DrevisionOnScmFailure=NONE@

h2. Post migration cleanup by SWF Team

When a project was cleaned by its team this one has to open a task for the SWF team to ask it to update related continuous integration jobs and fisheye repositories.

  </div>
</div>
